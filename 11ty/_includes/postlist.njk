<!doctype html>
<html data-theme="light">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>{{ metadata.blogName }}</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/post.css">
    <link rel="stylesheet" href="../css/skeleton.css">
    <link rel="stylesheet" href="../css/home.css">
    <link rel="stylesheet" href="../css/prism-theme.css">
  </head>
  <body>
    <section class="main">

      <div class="content-wrapper">
        <div class="navbar">
          <div class="nav-item">
            <a href="/_site/home/index.html" id="logo">{{ metadata.blogName }}</a>
          </div>
          {# theme switcher button #}
          <div class="nav-item">
            <label class="switch">
              <input type="checkbox" id="theme-switcher-button">
              <span class="slider round"></span>
            </label>
          </div>
        </div>

        {# blog title #}
        <h1 class="post-title">{{ title }}</h1>
        {# tags #}
        <div class="tags">
          {% for tag in tags %}
            <a class="tag" href="#">
              {{ tag }}
            </a>
          {% endfor %}
        </div>
        <hr>

        {# home page description #}
        <article class="post">{{ content | safe }}</article>

        <div class = "post-list">
          <ul>
            {% for post in collections.all %}
              {% if post.data.title != title %}
                <li>
                  <a href="/_site{{ post.url }}index.html">{{ post.data.title }}
                  </a>
                  <span class="post-date"> ({{ post.date | formatDate }}) </span>
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>

      </div>
      {# Javascript for theme switching, light/dark mode. #}
      {# <script type="text/javascript" src="../js/theme_switch.js" async defer/> #}
    </section>
    <script type="text/javascript">
      const themeName = {
        DARK: 'dark',
        LIGHT: 'light'
      };

      // current state of the slider.
      let btnState = themeName.LIGHT;
      // currently activated theme
      let currentTheme = themeName.LIGHT;
      const switchBtn = document.getElementById('theme-switcher-button');
      switchBtn.checked = false;
      const cached = localStorage.getItem('theme');

      if (cached) {
        currentTheme = cached;
      } else {
        localStorage.setItem('theme', currentTheme);
      }

      document
        .documentElement
        .setAttribute('data-theme', currentTheme);
      // if the slider is unclicked when the page is loaded
      // but the cached theme is found to be dark, then simulate
      // a click before registering the event listener to sync the state
      // of the slider and the currently active theme.
      if (currentTheme != btnState) 
        switchBtn.checked = true;
      
      switchBtn.onclick = () => {
        if (currentTheme == themeName.DARK) 
          currentTheme = themeName.LIGHT;
        else 
          currentTheme = themeName.DARK;
        btnState = currentTheme;

        localStorage.setItem('theme', currentTheme);
        document
          .documentElement
          .setAttribute('data-theme', currentTheme);
      };
    </script>

  </body>
</html>